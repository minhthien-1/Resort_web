<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Resort Booking ‚Äì Trang ch·ªß</title>
  <link rel="stylesheet" href="home.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    .resort-card {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-profile-link {
      display: flex;
      align-items: center;
      gap: 8px;
      color: white;
      text-decoration: none;
      padding: 10px 15px;
      border-radius: 5px;
      transition: background 0.3s ease;
      cursor: pointer;
    }

    .user-profile-link:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .user-profile-link .avatar-icon {
      font-size: 20px;
    }

    .user-profile-link .user-name-text {
      font-weight: 500;
    }
    .btn-logout {
      background: #dc3545;
      color: white;
      border: none;
      
      padding: 8px 20px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
      font-weight: 500;
    }

    .btn-logout:hover {
      background: #c82333;
    }

    /* Styles cho location search */
    .location-search-container {
      position: relative;
      width: 100%;
    }

    .location-search-container input {
      display : flex;
      align-items: center;
      width: 400px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 50px;
      font-size: 16px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      font-weight: bold;
      margin-top: 0px;
    }


    #locationSuggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 5px 5px;
      max-height: 200px;
      overflow-y: auto;
      display: none;
      z-index: 100;
      margin-top: 0;
    }

    #locationSuggestions.show {
      display: block;
    }

    .suggestion-item {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }

    .suggestion-item:hover {
      background: #f5f5f5;
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }



  </style>
</head>
<body>
  <!--Banner-->
  <div class="banner">
    <div class="banner-slide">
      <img src ="../public/Assets/image-banner/banner1.jpg" alt="Banner" class="navbar-banner"/>
    </div>
    <div class="banner-slide">
      <img src ="../public/Assets/image-banner/banner2.jpg" alt="Banner" class="navbar-banner"/>
    </div>
    <div class="banner-slide">
      <img src ="../public/Assets/image-banner/banner3.jpg" alt="Banner" class="navbar-banner"/>
    </div>
    <div class="banner-slide">
      <img src ="../public/Assets/image-banner/banner4.jpg" alt="Banner" class="navbar-banner"/>
    </div>
  </div>

  <div class="navbar-container">
    <div class="navbar-logo">
      <h1>Resort Booking </h1>
    </div>

    <!--Thanh menu-->
    <div class="navbar-menu">
      <nav>
        <a href="../public/promotions.html">Khuy·∫øn m√£i</a>
        <a href="../public/supports/support.html">H·ªó tr·ª£</a>
        <a href="#">H·ª£p t√°c v·ªõi ch√∫ng t√¥i</a>
        <a href="my_bookings.html">ƒê·∫∑t ch·ªó c·ªßa t√¥i</a>
      </nav>
    </div>

    <div class="login-menu">
      <nav class="login-register">
        <a href="login.html" class="btn-login">ƒêƒÉng nh·∫≠p</a>
        <a href="register.html" class="btn-register">ƒêƒÉng k√Ω</a>
      </nav>
    </div>
  </div>
</header>

<button id="scrollToTopBtn" title="V·ªÅ ƒë·∫ßu trang">&#8679;</button>

  <div class="search-container">
    <div class="search-header">
      <h2>T√¨m resort ho√†n h·∫£o cho k·ª≥ ngh·ªâ c·ªßa b·∫°n</h2>
      <p>T·∫≠n h∆∞·ªüng nh·ªØng ∆∞u ƒë√£i t·ªët nh·∫•t cho k·ª≥ ngh·ªâ trong m∆° c·ªßa b·∫°n</p>
    </div>
    <div class="resort_type">
      <button class="type-btn active" data-type="resort">Kh√°ch s·∫°n</button>
      <button class="type-btn" data-type="villa">Bi·ªát th·ª±</button>
      <button class="type-btn" data-type="apartment">CƒÉn h·ªô</button>
    </div>
    <div class="search-instructions"></div>
    <section class="search-form">
      <label>
        
        <div class="location-search-container">
          <input 
            type="text" 
            id="location" 
            placeholder="Nh·∫≠p t√™n ƒë·ªãa ƒëi·ªÉm ho·∫∑c resort" 
            autocomplete="off"
          />
          <div id="locationSuggestions" class="suggestions-dropdown"></div>
        </div>
      </label>
      <label>
        
        <select id="roomType">
            <option value="">T·∫•t c·∫£ lo·∫°i ph√≤ng</option>
        </select>
      </label>
      <button id="searchBtn" class="search-btn-icon" title="T√¨m ki·∫øm">
         <i class="fas fa-search"></i>
      </button>
    </section>
  </div>

  <section class="resorts">
      <div id="room-cards-container" class="resort-grid"></div>
      <div id="pagination-container" class="pagination"></div>
  </section>

  <section class="promo-codes">
    <h2><span class="icon">üéÅ</span> M√£ ∆Øu ƒê√£i T·∫∑ng B·∫°n M·ªõi</h2>
    <button class="promo-arrow left" id="prevBtn"><i>&#10094;</i></button>
    <div class="promo-grid" id="promoGrid"></div>
    <button class="promo-arrow right" id="nextBtn"><i>&#10095;</i></button>
  </section>

  <section class="deals-section">
    <h2>∆Øu ƒë√£i n·ªïi b·∫≠t</h2>
    <div class="resort-grid" id="dealsGrid"></div>
  </section>

  <section class="popular-destinations">
    <h2>ƒêi·ªÉm ƒë·∫øn ph·ªï bi·∫øn</h2>
    <div class="destination-grid" id="destinationGrid"></div>
  </section>

  <section class="why-choose-us">
    <h2>V√¨ sao n√™n ch·ªçn Resort Booking?</h2>
    <div class="reasons">
      <div class="reason">
        <img src="Assets/Icon Images/thumbs-up.png" alt="ƒê·∫∑t ph√≤ng d·ªÖ d√†ng">
        <h4>ƒê·∫∑t ch·ªó d·ªÖ d√†ng</h4>
        <p>Ch·ªâ v√†i b∆∞·ªõc ƒë∆°n gi·∫£n ƒë·ªÉ ho√†n t·∫•t ƒë·∫∑t ph√≤ng c·ªßa b·∫°n.</p>
      </div>
      <div class="reason">
        <img src="Assets/Icon Images/voucher.png" alt="∆Øu ƒë√£i h·∫•p d·∫´n">
        <h4>∆Øu ƒë√£i h·∫•p d·∫´n</h4>
        <p>Gi√° t·ªët nh·∫•t m·ªói ng√†y d√†nh cho kh√°ch h√†ng th√¢n thi·∫øt.</p>
      </div>
      <div class="reason">
        <img src="Assets/Icon Images/customer-service.png" alt="H·ªó tr·ª£ 24/7">
        <h4>H·ªó tr·ª£ 24/7</h4>
        <p>ƒê·ªôi ng≈© CSKH s·∫µn s√†ng h·ªó tr·ª£ b·∫°n m·ªçi l√∫c, m·ªçi n∆°i.</p>
      </div>
    </div>
  </section>

  <footer>
    <div class="footer-container">
      <div class="footer-links">
        <a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a>
        <span>|</span>
        <a href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a>
        <span>|</span>
        <a href="#">Li√™n h·ªá</a>
      </div>
      <div class="footer-social">
        <p>Theo d√µi ch√∫ng t√¥i</p>
        <div class="social-icons">
          <a href="#"><img src="Assets/Icon Images/facebook.png" alt="Facebook"></a>
          <a href="#"><img src="Assets/Icon Images/instagram.png" alt="Instagram"></a>
          <a href="#"><img src="Assets/Icon Images/communication.png" alt="Telegram"></a>
          <a href="#"><img src="https://cdn-icons-png.flaticon.com/512/3046/3046126.png" alt="TikTok"></a>
        </div>
      </div>
      <br/>
      <p>¬© 2025 <span>Resort Booking</span>. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/vn.js"></script>
  <script src="voucher.js"></script>
  <script src="destinations.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', async () => {
      let allRooms = [];
      let currentPage = 1;
      const itemsPerPage = 6;
      const API_BASE = "http://localhost:5500";

      function resolveImageUrl(url) {
        if (!url) return 'Assets/placeholder.jpg';
        if (/^https?:\/\//i.test(url)) return url;
        if (url.startsWith('/')) return API_BASE + url;
        return API_BASE + '/uploads/' + url;
      }

      function getLocationName(key) {
          const locationMap = { 'da-lat': 'ƒê√† L·∫°t', 'ha-long': 'H·∫° Long', 'phu-quoc': 'Ph√∫ Qu·ªëc', 'nha-trang': 'Nha Trang', 'da-nang': 'ƒê√† N·∫µng', 'sapa': 'Sapa', 'hoi-an': 'H·ªôi An', 'ha-noi': 'H√† N·ªôi', 'sai-gon': 'S√†i G√≤n' };
          return locationMap[key] || key || 'Kh√¥ng x√°c ƒë·ªãnh';
      }

      async function fetchRooms() {
          try {
              const response = await fetch(`${API_BASE}/api/rooms`);
              if (!response.ok) throw new Error('Network response was not ok');
              allRooms = await response.json();
              populateRoomTypes();
          } catch (error) {
              console.error('L·ªói khi l·∫•y d·ªØ li·ªáu ph√≤ng:', error);
              allRooms = [];
          }
      }

      // Populate room types dropdown
      function populateRoomTypes() {
          const roomTypeSelect = document.getElementById('roomType');
          const uniqueRoomTypes = [...new Set(allRooms.map(room => room.room_type))];
          
          uniqueRoomTypes.forEach(roomType => {
              if (roomType) {
                  const option = document.createElement('option');
                  option.value = roomType;
                  option.textContent = roomType;
                  roomTypeSelect.appendChild(option);
              }
          });
      }

      // Location search with suggestions
      const locationInput = document.getElementById('location');
      const suggestionsList = document.getElementById('locationSuggestions');

      locationInput.addEventListener('input', (e) => {
          const searchTerm = e.target.value.toLowerCase().trim();

          if (!searchTerm) {
              suggestionsList.classList.remove('show');
              return;
          }

          // L·∫•y t·∫•t c·∫£ ƒë·ªãa ƒëi·ªÉm + t√™n resort t·ª´ d·ªØ li·ªáu
          const suggestions = new Set();
          allRooms.forEach(room => {
              if (room.location) {
                  suggestions.add(getLocationName(room.location));
              }
              if (room.resort_name && room.resort_name.toLowerCase().includes(searchTerm)) {
                  suggestions.add(room.resort_name);
              }
          });

          // Filter suggestions theo search term
          const filtered = Array.from(suggestions).filter(item => 
              item.toLowerCase().includes(searchTerm)
          );

          if (filtered.length === 0) {
              suggestionsList.classList.remove('show');
              return;
          }

          // Display suggestions
          suggestionsList.innerHTML = filtered.map(item => 
              `<div class="suggestion-item">${item}</div>`
          ).join('');
          suggestionsList.classList.add('show');

          // Add click event to suggestions
          document.querySelectorAll('.suggestion-item').forEach(item => {
              item.addEventListener('click', () => {
                  locationInput.value = item.textContent;
                  suggestionsList.classList.remove('show');
              });
          });
      });

      // Close suggestions when clicking outside
      document.addEventListener('click', (e) => {
          if (e.target !== locationInput) {
              suggestionsList.classList.remove('show');
          }
      });

      function renderRooms(roomsToDisplay) {
        const container = document.getElementById("room-cards-container");
        if (!container) return;
        container.innerHTML = "";

        if (!roomsToDisplay || roomsToDisplay.length === 0) {
            container.innerHTML = '<p style="text-align: center; width: 100%; padding: 2rem 0;">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p.</p>';
            return;
        }

        roomsToDisplay.forEach((room) => {
          const card = document.createElement("a");
          card.className = "resort-card";
          card.href = `resort_detail.html?id=${room.id}`;

          const formattedPrice = new Intl.NumberFormat("vi-VN", { style: "currency", currency: "VND" }).format(room.price_per_night);
          const imageUrl = resolveImageUrl(room.images?.[0]);

          card.innerHTML = `
            <img src="${imageUrl}" alt="${room.resort_name || room.room_type}">
            <div class="resort-info">
                <h3>${room.resort_name || room.room_type}</h3>
                <p><i class="fas fa-map-marker-alt"></i> ${getLocationName(room.location)}</p>
                <p class="price">T·ª´ : <span>${formattedPrice}/ƒë√™m</span></p>
            </div>
          `;
          container.appendChild(card);
        });
      }

      function renderRoomsForCurrentPage() {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const roomsToRender = allRooms.slice(startIndex, endIndex);
        renderRooms(roomsToRender);
      }

      function renderPagination() {
          const paginationContainer = document.getElementById('pagination-container');
          if (!paginationContainer) return;
          paginationContainer.innerHTML = '';
          const totalPages = Math.ceil(allRooms.length / itemsPerPage);
          if (totalPages <= 1) {
              paginationContainer.style.display = 'none';
              return;
          };
          paginationContainer.style.display = 'flex';

          const prevButton = document.createElement('button');
          prevButton.className = 'page-btn';
          prevButton.innerHTML = `<i class="fas fa-chevron-left"></i>`;
          if (currentPage === 1) prevButton.disabled = true;
          prevButton.addEventListener('click', () => {
              if (currentPage > 1) {
                  currentPage--;
                  renderRoomsForCurrentPage();
                  renderPagination();
                  document.getElementById('room-cards-container').scrollIntoView({ behavior: 'smooth' });
              }
          });
          paginationContainer.appendChild(prevButton);

          for (let i = 1; i <= totalPages; i++) {
              const pageButton = document.createElement('button');
              pageButton.className = 'page-btn';
              pageButton.textContent = i;
              if (i === currentPage) pageButton.classList.add('active');
              pageButton.addEventListener('click', () => {
                  currentPage = i;
                  renderRoomsForCurrentPage();
                  renderPagination();
                  document.getElementById('room-cards-container').scrollIntoView({ behavior: 'smooth' });
              });
              paginationContainer.appendChild(pageButton);
          }

          const nextButton = document.createElement('button');
          nextButton.className = 'page-btn';
          nextButton.innerHTML = `<i class="fas fa-chevron-right"></i>`;
          if (currentPage === totalPages) nextButton.disabled = true;
          nextButton.addEventListener('click', () => {
              if (currentPage < totalPages) {
                  currentPage++;
                  renderRoomsForCurrentPage();
                  renderPagination();
                  document.getElementById('room-cards-container').scrollIntoView({ behavior: 'smooth' });
              }
          });
          paginationContainer.appendChild(nextButton);
      }
      
      const token = localStorage.getItem('token');
      const role = localStorage.getItem('role');
      if (token && (role === 'admin' || role === 'staff')) {
          window.location.href = '/admin/index.html';
          return;
      }

      await fetchRooms();
      renderRoomsForCurrentPage();
      renderPagination();

      const dealsContainer = document.getElementById('dealsGrid');
      if(dealsContainer){
          dealsContainer.innerHTML = '';
          allRooms.slice(0, 4).forEach(room => {
              const card = document.createElement('a');
              card.className = 'resort-card';
              card.href = `resort_detail.html?id=${room.id}`;
              const formattedPrice = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(room.price_per_night);
              const imageUrl = resolveImageUrl(room.images?.[0]);
              card.innerHTML = `
                  <img src="${imageUrl}" alt="${room.resort_name || room.room_type}">
                  <div class="resort-info">
                      <h3>${room.resort_name || room.room_type}</h3>
                      <p><i class="fas fa-map-marker-alt"></i> ${getLocationName(room.location)}</p>
                      <p class="price">T·ª´: <span> ${formattedPrice}/ƒë√™m</span></p>
                  </div>`;
              dealsContainer.appendChild(card);
          });
      }

      // Search functionality
      document.getElementById('searchBtn').addEventListener('click', () => {
          const locationValue = locationInput.value.toLowerCase().trim();
          const roomTypeValue = document.getElementById('roomType').value;

          const filteredRooms = allRooms.filter(room => {
              const locationName = getLocationName(room.location);
              const matchesLocation = !locationValue || 
                                      locationName.toLowerCase().includes(locationValue) || 
                                      (room.resort_name && room.resort_name.toLowerCase().includes(locationValue));
              const matchesRoomType = !roomTypeValue || room.room_type === roomTypeValue;
              return matchesLocation && matchesRoomType;
          });
          
          document.getElementById('pagination-container').style.display = 'none';
          renderRooms(filteredRooms);
      });

      document.querySelectorAll('.type-btn').forEach(btn => {
          btn.addEventListener('click', () => {
              document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
              btn.classList.add('active');
          });
      });
      
      document.getElementById('nextBtn').onclick = () => document.getElementById('promoGrid').scrollBy({ left: 360, behavior: 'smooth' });
      document.getElementById('prevBtn').onclick = () => document.getElementById('promoGrid').scrollBy({ left: -360, behavior: 'smooth' });

      if (typeof destinations !== 'undefined') {
          destinations.forEach(place => {
              const card = document.createElement('div');
              card.className = 'destination-card';
              card.innerHTML = `
                <img src="${place.image}" alt="${place.name}">
                <p>${place.name}</p>
              `;
              document.getElementById('destinationGrid').appendChild(card);
          });
      }
  });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const navbarMenu = document.querySelector(".navbar-menu");
      const username = localStorage.getItem("username");
      const full_name = localStorage.getItem("full_name");
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');

      if (username || full_name || currentUser.id) {
        const displayName = username || full_name || currentUser.username;
        
        navbarMenu.innerHTML = `
          <a href="">Khuy·∫øn m√£i</a>
          <a href="supports/support.html">H·ªó tr·ª£</a>
          <a href="">H·ª£p t√°c v·ªõi ch√∫ng t√¥i</a>
          <a href="my_bookings.html">ƒê·∫∑t ch·ªó c·ªßa t√¥i</a>
          <div class="user-menu">
            <a href="profile.html" class="user-profile-link">
              <span class="avatar-icon">üë§</span>
              <span class="user-name-text">${displayName}</span>
            </a>
            <button id="logoutBtn" class="btn-logout">ƒêƒÉng xu·∫•t</button>
          </div>
        `;
        
        document.getElementById("logoutBtn").addEventListener("click", () => {
          localStorage.clear();
          window.location.href = "login.html";
        });
      }
    });

    document.addEventListener("DOMContentLoaded", function() {

  let slideIndex = 0; 
  showSlides(); 
  

  //chuy·ªÉn slide
  function showSlides() {
    let slides = document.querySelectorAll(".banner-slide");

    // 1. ·∫®n t·∫•t c·∫£ c√°c slide
    for (let i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";
      slides[i].classList.remove("active");
    }

    // 2. TƒÉng ch·ªâ s·ªë slide
    slideIndex++;

    // 3. Quay v·ªÅ slide ƒë·∫ßu ti√™n n·∫øu ƒë√£ ƒëi h·∫øt
    if (slideIndex > slides.length) {
      slideIndex = 1;
    }

    // 4. Hi·ªÉn th·ªã slide hi·ªán t·∫°i
    if (slides.length > 0) {
      slides[slideIndex - 1].style.display = "block";
      slides[slideIndex - 1].classList.add("active");
    }
    // 5. T·ª± ƒë·ªông chuy·ªÉn slide sau 6 gi√¢y
    setTimeout(showSlides, 6000); 
  }
});


  // L·∫•y navbar
window.addEventListener('scroll', function() {
  const navbar = document.querySelector('.navbar');
  if (window.scrollY > 50) {
    navbar.classList.add('shrink');
  } else {
    navbar.classList.remove('shrink');
  }
});

// N√∫t v·ªÅ ƒë·∫ßu trang
document.addEventListener('DOMContentLoaded', async () => {
    
    const scrollToTopBtn = document.getElementById('scrollToTopBtn');

    if (scrollToTopBtn) {
        
        window.addEventListener('scroll', () => {
            
            if (window.scrollY > 300) {
                scrollToTopBtn.style.display = 'block';
            } else {
                scrollToTopBtn.style.display = 'none';
            }
        });

        
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0, 
                behavior: 'smooth' 
            });
        });
    }
});
  </script>
</body>
</html>
