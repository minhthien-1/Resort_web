<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Resort Booking ‚Äì Trang ch·ªß</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
    }

    /* ====== NAVBAR ====== */
    .navbar {
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      position: fixed;
      width: 100%;
      top: 0;
      left: 0;
      z-index: 1000;
    }

    .navbar-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .navbar-logo h1 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 24px;
      font-weight: 800;
      margin: 0;
    }

    .navbar-menu {
      display: flex;
      gap: 30px;
      align-items: center;
    }

    .navbar-menu a {
      text-decoration: none;
      color: #2d3748;
      font-weight: 500;
      transition: 0.3s;
    }

    .btn-login, .btn-register {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: 0.3s;
    }

    .btn-login {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-register {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }

    /* ====== SEARCH CONTAINER ====== */
    .search-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 120px 20px 60px;
      text-align: center;
      margin-top: 60px;
    }

    .search-header h2 {
      font-size: 40px;
      margin-bottom: 10px;
      font-weight: 800;
    }

    .search-header p {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 30px;
    }

    .search-form {
      display: flex;
      gap: 12px;
      max-width: 900px;
      margin: 0 auto;
      justify-content: center;
    }

    .search-form label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
    }

    .search-form label span {
      font-size: 12px;
      text-align: left;
      font-weight: 600;
    }

    .search-form input,
    .search-form select {
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      height: 48px;
    }

    .search-btn-icon {
      background: #f5576c;
      color: white;
      border: none;
      width: 48px;
      height: 48px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 28px;
      transition: 0.3s;
    }

    .search-btn-icon:hover {
      transform: scale(1.05);
    }

    /* ====== MAIN CONTENT ====== */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .section-title {
      font-size: 24px;
      color: #2d3748;
      font-weight: 800;
      margin: 60px 0 40px;
      display: block;
      text-align: left;
    }

    /* ====== VOUCHERS SECTION ====== */
    .vouchers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 80px;
    }

    .voucher-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      transition: all 0.3s;
      border-left: 4px solid #667eea;
    }

    .voucher-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }

    .voucher-code {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
      color: #667eea;
      padding: 8px 12px;
      border-radius: 6px;
      font-weight: 800;
      margin-bottom: 10px;
      display: inline-block;
      border: 1px dashed #667eea;
      font-size: 13px;
    }

    .voucher-card h3 {
      font-size: 15px;
      color: #2d3748;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .voucher-card p {
      color: #718096;
      font-size: 13px;
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .voucher-expire {
      color: #f5576c;
      font-size: 11px;
      font-weight: 600;
    }

    /* ====== DESTINATIONS SECTION ====== */
    .destinations-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 16px;
      margin-bottom: 80px;
    }

    .destination-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      color: inherit;
    }

    .destination-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    }

    .destination-card-image {
      width: 100%;
      height: 120px;
      background: #e2e8f0;
      overflow: hidden;
    }

    .destination-card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: 0.5s;
    }

    .destination-card:hover .destination-card-image img {
      transform: scale(1.1);
    }

    .destination-card-name {
      padding: 12px;
      text-align: center;
      font-weight: 700;
      color: #2d3748;
      font-size: 14px;
    }

    /* ====== RESORTS SECTION ====== */
    .resorts {
      margin-bottom: 60px;
    }

    .resort-group {
      margin-bottom: 80px;
    }

    .resort-group-title {
      font-size: 24px;
      color: #2d3748;
      font-weight: 700;
      margin-top: 60px;
      margin-bottom: 30px;
      padding-bottom: 12px;
      border-bottom: 3px solid #667eea;
      display: block;
      text-align: left;
      width: 100%;
    }

    .rooms-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-top: 30px;
    }

    .room-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      transition: all 0.3s;
      cursor: pointer;
    }

    .room-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.12);
    }

    .room-card-image {
      width: 100%;
      height: 200px;
      background: #e2e8f0;
      overflow: hidden;
    }

    .room-card-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: 0.5s;
    }

    .room-card:hover .room-card-image img {
      transform: scale(1.1);
    }

    .room-card-content {
      padding: 18px;
    }

    .room-card-content h3 {
      font-size: 16px;
      color: #2d3748;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .room-card-content p {
      color: #718096;
      font-size: 13px;
      margin: 6px 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .room-price {
      margin-top: 12px;
      font-size: 18px;
      font-weight: 800;
      color: #667eea;
    }

    /* ====== PAGINATION ====== */
    .pagination {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 50px;
    }

    .page-btn {
      width: 44px;
      height: 44px;
      border: 2px solid #e2e8f0;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }

    .page-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }

    .page-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: transparent;
    }

    /* ====== FOOTER ====== */
    footer {
      background: #1a202c;
      color: white;
      text-align: center;
      padding: 40px;
      margin-top: 80px;
    }

    /* ====== RESPONSIVE ====== */
    @media (max-width: 1024px) {
      .rooms-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .destinations-grid {
        grid-template-columns: repeat(4, 1fr);
      }

      .vouchers-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .rooms-grid {
        grid-template-columns: 1fr;
      }

      .destinations-grid {
        grid-template-columns: repeat(3, 1fr);
      }

      .vouchers-grid {
        grid-template-columns: 1fr;
      }

      .search-form {
        flex-direction: column;
      }

      .search-header h2 {
        font-size: 28px;
      }

      .section-title {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <header class="navbar">
    <div class="navbar-container">
      <div class="navbar-logo">
        <h1>Resort Booking</h1>
      </div>
      <nav class="navbar-menu">
        <a href="">Khuy·∫øn m√£i</a>
        <a href="">H·ªó tr·ª£</a>
        <a href="">H·ª£p t√°c</a>
        <a href="my_bookings.html">ƒê·∫∑t ch·ªó</a>
            <a href="notifications.html" class="notif-btn">
                üîî <span id="notifCount" class="notif-count">0</span>
            </a>
        <a href="login.html" class="btn-login">ƒêƒÉng nh·∫≠p</a>
        <a href="register.html" class="btn-register">ƒêƒÉng k√Ω</a>
      </nav>
    </div>
  </header>

  <!-- SEARCH -->
  <div class="search-container">
    <div class="search-header">
      <h2>T√¨m Resort Ho√†n H·∫£o</h2>
      <p>Kh√°m ph√° nh·ªØng k·ª≥ ngh·ªâ tuy·ªát v·ªùi</p>
    </div>

    <section class="search-form">
      <label>
        <span>ƒê·ªãa ƒëi·ªÉm</span>
        <input type="text" id="location" placeholder="Nh·∫≠p t√™n ƒë·ªãa ƒëi·ªÉm">
      </label>
      <label>
        <span>Lo·∫°i ph√≤ng</span>
        <select id="roomType">
          <option value="">T·∫•t c·∫£ lo·∫°i ph√≤ng</option>
        </select>
      </label>
      <button id="searchBtn" class="search-btn-icon">
        <i class="fas fa-search"></i>
      </button>
    </section>
  </div>


  <!-- MAIN CONTENT -->
  <section class="container">
    <!-- VOUCHERS -->
    <h2 class="section-title">üé´ ∆Øu ƒê√£i ƒê·∫∑c Bi·ªát</h2>
    <div id="vouchers-container" class="vouchers-grid"></div>

    <!-- DESTINATIONS -->
    <h2 class="section-title">üìç ƒêi·ªÉm ƒê·∫øn Ph·ªï Bi·∫øn</h2>
    <div id="destinations-container" class="destinations-grid"></div>

    <!-- RESORTS -->
    <div id="room-cards-container"></div>
    <div id="pagination-container" class="pagination"></div>
  </section>


  <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 Resort Booking. All rights reserved.</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      let allRooms = [];
      let currentPage = 1;
      const itemsPerPage = 6;
      const API_BASE = "http://localhost:5500";

      // ===== HELPER FUNCTIONS =====
      function resolveImageUrl(url) {
        if (!url) return 'https://via.placeholder.com/300x200?text=Room';
        if (/^https?:\/\//i.test(url)) return url;
        return API_BASE + '/uploads/' + url;
      }

      function formatPrice(price) {
        return new Intl.NumberFormat('vi-VN', {
          style: 'currency',
          currency: 'VND'
        }).format(price);
      }

      function getLocationName(key) {
        const map = {
          'da-lat': 'ƒê√† L·∫°t',
          'ha-long': 'H·∫° Long',
          'phu-quoc': 'Ph√∫ Qu·ªëc',
          'nha-trang': 'Nha Trang',
          'da-nang': 'ƒê√† N·∫µng',
          'sapa': 'Sapa',
          'hoi-an': 'H·ªôi An',
          'ha-noi': 'H√† N·ªôi'
        };
        return map[key] || key || 'Ch∆∞a x√°c ƒë·ªãnh';
      }

      // ===== FETCH VOUCHERS =====
      async function fetchVouchers() {
        try {
          const response = await fetch(`${API_BASE}/api/discounts`);
          if (response.ok) {
            const vouchers = await response.json();
            renderVouchers(vouchers);
          }
        } catch (error) {
          console.log('Vouchers API not available');
        }
      }

      function renderVouchers(vouchers) {
      const container = document.getElementById('vouchers-container');
      container.innerHTML = '';

      if (!vouchers || vouchers.length === 0) return;

      vouchers.slice(0, 4).forEach(voucher => {
        const card = document.createElement('div');
        card.className = 'voucher-card';
        
        const validUntil = new Date(voucher.valid_until).toLocaleDateString('vi-VN');
        const discountText = voucher.discount_type === 'percentage' 
          ? `Gi·∫£m ${voucher.value}%` 
          : `Gi·∫£m ${voucher.value}ƒë`;
        
        card.innerHTML = `
          <div class="voucher-code">${voucher.code}</div>
          <h3>${voucher.name}</h3>
          <p>${voucher.description}</p>
          <p style="margin-top: 8px; font-size: 13px; color: #667eea; font-weight: 600;">${discountText}</p>
          <div class="voucher-expire">H·∫°n: ${validUntil}</div>
        `;
        container.appendChild(card);
      });
      }


      // ===== EXTRACT & RENDER DESTINATIONS =====
      function renderDestinations(rooms) {
        const container = document.getElementById('destinations-container');
        container.innerHTML = '';

        const locations = [...new Set(rooms.map(r => r.location))];
        const locationMap = {
          'da-lat': 'ƒê√† L·∫°t',
          'ha-long': 'H·∫° Long',
          'phu-quoc': 'Ph√∫ Qu·ªëc',
          'nha-trang': 'Nha Trang',
          'da-nang': 'ƒê√† N·∫µng',
          'sapa': 'Sapa',
          'hoi-an': 'H·ªôi An',
          'ha-noi': 'H√† N·ªôi'
        };

        locations.forEach(loc => {
          if (!loc) return;
          const card = document.createElement('a');
          card.className = 'destination-card';
          card.href = `destinations.html?location=${loc}`;

          const imgUrls = {
            'da-lat': 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=300&h=150&fit=crop',
            'ha-long': 'https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?w=300&h=150&fit=crop',
            'phu-quoc': 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=300&h=150&fit=crop',
            'nha-trang': 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=300&h=150&fit=crop',
            'da-nang': 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=300&h=150&fit=crop',
            'sapa': 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=300&h=150&fit=crop',
            'hoi-an': 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=300&h=150&fit=crop',
            'ha-noi': 'https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?w=300&h=150&fit=crop'
          };

          card.innerHTML = `
            <div class="destination-card-image">
              <img src="${imgUrls[loc] || 'https://via.placeholder.com/300x150'}" alt="${locationMap[loc] || loc}">
            </div>
            <div class="destination-card-name">${locationMap[loc] || loc}</div>
          `;
          container.appendChild(card);
        });
      }

      // ===== GROUP ROOMS BY RESORT =====
      function groupRoomsByResort(rooms) {
        const grouped = {};
        rooms.forEach(room => {
          const resort = room.resort_name || 'Kh√¥ng x√°c ƒë·ªãnh';
          if (!grouped[resort]) grouped[resort] = [];
          grouped[resort].push(room);
        });
        return grouped;
      }

      // ===== RENDER ROOMS =====
      function renderRooms(roomsToDisplay) {
        const container = document.getElementById('room-cards-container');
        container.innerHTML = '';

        if (!roomsToDisplay || roomsToDisplay.length === 0) {
          container.innerHTML = '<p style="text-align:center; padding:40px; color:#718096;">Kh√¥ng t√¨m th·∫•y ph√≤ng ph√π h·ª£p</p>';
          return;
        }

        const grouped = groupRoomsByResort(roomsToDisplay);

        Object.entries(grouped).forEach(([resortName, rooms]) => {
          const title = document.createElement('h3');
          title.className = 'resort-group-title';
          title.textContent = `üè® ${resortName}`;
          container.appendChild(title);

          const grid = document.createElement('div');
          grid.className = 'rooms-grid';

          rooms.forEach(room => {
            const card = document.createElement('div');
            card.className = 'room-card';
            card.style.cursor = 'pointer';
            card.onclick = () => window.location.href = `resort_detail.html?id=${room.id}`;

            const imageUrl = resolveImageUrl(room.images?.[0]);

            card.innerHTML = `
              <div class="room-card-image">
                <img src="${imageUrl}" alt="${room.room_type}" onerror="this.src='https://via.placeholder.com/300x200?text=Room'">
              </div>
              <div class="room-card-content">
                <h3>${room.room_type}</h3>
                <p><i class="fas fa-map-marker-alt"></i> ${getLocationName(room.location)}</p>
                <p><i class="fas fa-door-open"></i> ${room.num_bed || 'Ch∆∞a x√°c ƒë·ªãnh'}</p>
                <div class="room-price">${formatPrice(room.price_per_night)}/ƒë√™m</div>
              </div>
            `;

            grid.appendChild(card);
          });

          container.appendChild(grid);
        });
      }

      // ===== FETCH DATA =====
      async function fetchRooms() {
        try {
          const response = await fetch(`${API_BASE}/api/rooms`);
          if (!response.ok) throw new Error('Network error');
          allRooms = await response.json();
          populateRoomTypes();
          renderDestinations(allRooms);
        } catch (error) {
          console.error('Error:', error);
          allRooms = [];
        }
      }

      function populateRoomTypes() {
        const select = document.getElementById('roomType');
        const types = [...new Set(allRooms.map(r => r.room_type))];
        types.forEach(type => {
          if (type) {
            const opt = document.createElement('option');
            opt.value = type;
            opt.textContent = type;
            select.appendChild(opt);
          }
        });
      }

      // ===== PAGINATION =====
      function renderPagination() {
        const container = document.getElementById('pagination-container');
        container.innerHTML = '';
        const total = Math.ceil(allRooms.length / itemsPerPage);

        if (total <= 1) return;

        for (let i = 1; i <= total; i++) {
          const btn = document.createElement('button');
          btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
          btn.textContent = i;
          btn.onclick = () => {
            currentPage = i;
            const start = (i - 1) * itemsPerPage;
            renderRooms(allRooms.slice(start, start + itemsPerPage));
            renderPagination();
            window.scrollTo({ top: 300, behavior: 'smooth' });
          };
          container.appendChild(btn);
        }
      }

      function renderCurrentPage() {
        const start = (currentPage - 1) * itemsPerPage;
        renderRooms(allRooms.slice(start, start + itemsPerPage));
      }

      // ===== SEARCH =====
      document.getElementById('searchBtn').onclick = () => {
        const location = document.getElementById('location').value.toLowerCase();
        const type = document.getElementById('roomType').value;

        const filtered = allRooms.filter(room => {
          const matchLoc = !location || 
                          getLocationName(room.location).toLowerCase().includes(location) ||
                          (room.resort_name && room.resort_name.toLowerCase().includes(location));
          const matchType = !type || room.room_type === type;
          return matchLoc && matchType;
        });

        document.getElementById('pagination-container').innerHTML = '';
        renderRooms(filtered);
      };

      // ===== INIT =====
      await fetchRooms();
      await fetchVouchers();
      renderCurrentPage();
      renderPagination();
    });

    

   

  </script>

          <!-- Notifications Script -->
          <script>
            const API_BASE = "http://localhost:5500"; // thay b·∫±ng URL API c·ªßa b·∫°n

            // S·ª¨A: Ch·ªâ c·∫ßn gi·ªØ l·∫°i notifCount
            const notifCount = document.getElementById("notifCount");

            // X√ìA B·ªé: kh√¥ng c·∫ßn notifBtn, notifBox, notifList, seeMoreBtn n·ªØa
            // X√ìA B·ªé: c√°c event listener cho notifBtn v√† seeMoreBtn

            // L·∫•y th√¥ng b√°o t·ª´ API (ch·ªâ ƒë·ªÉ C·∫¨P NH·∫¨T S·ªê L∆Ø·ª¢NG)
            async function loadNotifications() {
              try {
                const token = localStorage.getItem("token"); // n·∫øu c·∫ßn auth

                // T·ªëi ∆∞u: B·∫°n ch·ªâ c·∫ßn s·ªë l∆∞·ª£ng, n√™n g·ªçi API n√†o nh·∫π nh·∫•t c√≥ th·ªÉ
                // N·∫øu API c·ªßa b·∫°n h·ªó tr·ª£, h√£y g·ªçi m·ªôt endpoint ch·ªâ tr·∫£ v·ªÅ s·ªë l∆∞·ª£ng.
                // N·∫øu kh√¥ng, d√πng limit=1 c≈©ng ƒë∆∞·ª£c cho nh·∫π.
                const res = await fetch(`${API_BASE}/notifications?limit=1`, {
                  headers: { "Authorization": `Bearer ${token}` }
                });
                const data = await res.json();
                
                // S·ª¨A: X√≥a b·ªè ph·∫ßn l·∫∑p (forEach) v√† c·∫≠p nh·∫≠t notifList

                // Ch·ªâ c·∫≠p nh·∫≠t s·ªë ch∆∞a ƒë·ªçc
                notifCount.textContent = data.unreadCount || 0;

              } catch (err) {
                console.error("L·ªói load notifications:", err);
              }
            }

            // Load khi m·ªü trang
            loadNotifications();

            // T·ª± refresh m·ªói 60s
            setInterval(loadNotifications, 60000);
          </script>

  



</body>
</html>