<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Resort Booking ‚Äì Trang ch·ªß</title>
  <link rel="stylesheet" href="home.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
<script src="home.js"></script>
  <header class="navbar">
    <div class="navbar-container">
      <div class="navbar-logo">
        <h1>Resort Booking</h1>
      </div>
      <nav class="navbar-menu">
        <a href="">Khuy·∫øn m√£i</a>
        <a href="supports/support.html">H·ªó tr·ª£</a>
        <a href="">H·ª£p t√°c v·ªõi ch√∫ng t√¥i</a>
        <a href="">ƒê·∫∑t ch·ªó c·ªßa t√¥i</a>
        <a href="login.html" class="btn-login">ƒêƒÉng nh·∫≠p</a>
        <a href="register.html" class="btn-register">ƒêƒÉng k√Ω</a>
      </nav>
    </div>
  </header>

  <div class="search-container">
    <div class="search-header">
      <h2>T√¨m resort ho√†n h·∫£o cho k·ª≥ ngh·ªâ c·ªßa b·∫°n</h2>
      <p>T·∫≠n h∆∞·ªüng nh·ªØng ∆∞u ƒë√£i t·ªët nh·∫•t cho k·ª≥ ngh·ªâ trong m∆° c·ªßa b·∫°n</p>
    </div>
    <div class="resort_type">
      <button class="type-btn active" data-type="resort">Kh√°ch s·∫°n</button>
      <button class="type-btn" data-type="villa">Bi·ªát th·ª±</button>
      <button class="type-btn" data-type="apartment">CƒÉn h·ªô</button>
    </div>
    <div class="search-instructions"></div>
    <section class="search-form">
      <label>
        ƒê·ªãa ƒëi·ªÉm
        <input type="text" id="location" placeholder="Nh·∫≠p th√†nh ph·ªë ho·∫∑c resort" />
      </label>
      <label>
        Ng√†y nh·∫≠n & tr·∫£
        <input type="text" id="dateRange" placeholder="Ch·ªçn kho·∫£ng ng√†y" readonly />
      </label>
      <label>
        Lo·∫°i ph√≤ng
        <select id="roomType">
              <option value="">T·∫•t c·∫£ lo·∫°i ph√≤ng</option>
        </select>
      </label>
      <button id="searchBtn">T√¨m ki·∫øm</button>
    </section>
  </div>

  <section class="resorts">
      <div id="room-cards-container" class="resort-grid"></div>
      
      <div id="pagination-container" class="pagination"></div>
  </section>

  <section class="promo-codes">
    <h2><span class="icon">üéÅ</span> M√£ ∆Øu ƒê√£i T·∫∑ng B·∫°n M·ªõi</h2>
    <button class="promo-arrow left" id="prevBtn"><i>&#10094;</i></button>
    <div class="promo-grid" id="promoGrid"></div>
    <button class="promo-arrow right" id="nextBtn"><i>&#10095;</i></button>
  </section>

  <section class="deals-section">
    <h2>∆Øu ƒë√£i n·ªïi b·∫≠t</h2>
    <div class="resort-grid" id="dealsGrid">
      </div>
  </section>

  <section class="popular-destinations">
    <h2>ƒêi·ªÉm ƒë·∫øn ph·ªï bi·∫øn</h2>
    <div class="destination-grid" id="destinationGrid"></div>
  </section>

  <section class="why-choose-us">
    <h2>V√¨ sao n√™n ch·ªçn Resort Booking?</h2>
    <div class="reasons">
      <div class="reason">
        <img src="Assets/Icon Images/thumbs-up.png" alt="ƒê·∫∑t ph√≤ng d·ªÖ d√†ng">
        <h4>ƒê·∫∑t ch·ªó d·ªÖ d√†ng</h4>
        <p>Ch·ªâ v√†i b∆∞·ªõc ƒë∆°n gi·∫£n ƒë·ªÉ ho√†n t·∫•t ƒë·∫∑t ph√≤ng c·ªßa b·∫°n.</p>
      </div>
      <div class="reason">
        <img src="Assets/Icon Images/voucher.png" alt="∆Øu ƒë√£i h·∫•p d·∫´n">
        <h4>∆Øu ƒë√£i h·∫•p d·∫´n</h4>
        <p>Gi√° t·ªët nh·∫•t m·ªói ng√†y d√†nh cho kh√°ch h√†ng th√¢n thi·∫øt.</p>
      </div>
      <div class="reason">
        <img src="Assets/Icon Images/customer-service.png" alt="H·ªó tr·ª£ 24/7">
        <h4>H·ªó tr·ª£ 24/7</h4>
        <p>ƒê·ªôi ng≈© CSKH s·∫µn s√†ng h·ªó tr·ª£ b·∫°n m·ªçi l√∫c, m·ªçi n∆°i.</p>
      </div>
    </div>
  </section>

  <footer>
    <div class="footer-container">
      <div class="footer-links">
        <a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a>
        <span>|</span>
        <a href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a>
        <span>|</span>
        <a href="#">Li√™n h·ªá</a>
      </div>
      <div class="footer-social">
        <p>Theo d√µi ch√∫ng t√¥i</p>
        <div class="social-icons">
          <a href="#"><img src="Assets/Icon Images/facebook.png" alt="Facebook"></a>
          <a href="#"><img src="Assets/Icon Images/instagram.png" alt="Instagram"></a>
          <a href="#"><img src="Assets/Icon Images/communication.png" alt="Telegram"></a>
          <a href="#"><img src="https://cdn-icons-png.flaticon.com/512/3046/3046126.png" alt="TikTok"></a>
        </div>
      </div>
      <br/>
      <p>¬© 2025 <span>Resort Booking</span>. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/vn.js"></script>
  <script src="voucher.js"></script>
  <script src="destinations.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', async () => {
      let allRooms = [];
      let currentPage = 1;
      const itemsPerPage = 6; // <-- ƒê√É S·ª¨A TH√ÄNH 6 PH√íNG/TRANG

      function getLocationName(key) {
          const locationMap = {
              'da-lat': 'ƒê√† L·∫°t', 'ha-long': 'H·∫° Long', 'phu-quoc': 'Ph√∫ Qu·ªëc',
              'nha-trang': 'Nha Trang', 'da-nang': 'ƒê√† N·∫µng', 'sapa': 'Sapa',
              'hoi-an': 'H·ªôi An', 'ha-noi': 'H√† N·ªôi', 'sai-gon': 'S√†i G√≤n'
          };
          return locationMap[key] || key || 'Kh√¥ng x√°c ƒë·ªãnh';
      }

      async function fetchRooms() {
          try {
              const response = await fetch('http://localhost:5500/api/rooms');
              if (!response.ok) throw new Error('Network response was not ok');
              allRooms = await response.json();
          } catch (error) {
              console.error('L·ªói khi l·∫•y d·ªØ li·ªáu ph√≤ng:', error);
              allRooms = [];
          }
      }

     function renderRoomsForCurrentPage() {
  const container = document.getElementById("room-cards-container");
  if (!container) return;
  container.innerHTML = "";

  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const roomsToRender = allRooms.slice(startIndex, endIndex);

  roomsToRender.forEach((room) => {
    const card = document.createElement("div");
    card.className = "resort-card";
    const formattedPrice = new Intl.NumberFormat("vi-VN", {
      style: "currency",
      currency: "VND",
    }).format(room.price_per_night);

    // üü¢ Add the click event here:
    card.addEventListener("click", () => {
      window.location.href = `room.html?id=${room.id}`;
    });

    card.innerHTML = `
      <img src="${room.images?.[0] || 'Assets/placeholder.jpg'}" alt="${room.resort_name || room.room_type}">
      <div class="resort-info">
          <h3>${room.resort_name || room.room_type}</h3>
          <p><i class="fas fa-map-marker-alt"></i> ${getLocationName(room.location)}</p>
          <p class="price">T·ª´ <span>${formattedPrice}/ƒë√™m</span></p>
      </div>
    `;
    container.appendChild(card);
  });
}


      function renderPagination() {
          const paginationContainer = document.getElementById('pagination-container');
          if (!paginationContainer) return;
          
          paginationContainer.innerHTML = '';
          const totalPages = Math.ceil(allRooms.length / itemsPerPage);

          if (totalPages <= 1) return;

          const prevButton = document.createElement('button');
          prevButton.className = 'page-btn';
          prevButton.innerHTML = `<i class="fas fa-chevron-left"></i>`;
          if (currentPage === 1) prevButton.disabled = true;
          prevButton.addEventListener('click', () => {
              if (currentPage > 1) {
                  currentPage--;
                  renderRoomsForCurrentPage();
                  renderPagination();
                  document.getElementById('room-cards-container').scrollIntoView({ behavior: 'smooth' });
              }
          });
          paginationContainer.appendChild(prevButton);

          for (let i = 1; i <= totalPages; i++) {
              const pageButton = document.createElement('button');
              pageButton.className = 'page-btn';
              pageButton.textContent = i;
              if (i === currentPage) pageButton.classList.add('active');
              pageButton.addEventListener('click', () => {
                  currentPage = i;
                  renderRoomsForCurrentPage();
                  renderPagination();
                  document.getElementById('room-cards-container').scrollIntoView({ behavior: 'smooth' });
              });
              paginationContainer.appendChild(pageButton);
          }

          const nextButton = document.createElement('button');
          nextButton.className = 'page-btn';
          nextButton.innerHTML = `<i class="fas fa-chevron-right"></i>`;
          if (currentPage === totalPages) nextButton.disabled = true;
          nextButton.addEventListener('click', () => {
              if (currentPage < totalPages) {
                  currentPage++;
                  renderRoomsForCurrentPage();
                  renderPagination();
                  document.getElementById('room-cards-container').scrollIntoView({ behavior: 'smooth' });
              }
          });
          paginationContainer.appendChild(nextButton);
      }
      
      const token = localStorage.getItem('token');
      const role = localStorage.getItem('role');
      if (token && (role === 'admin' || role === 'staff')) {
          window.location.href = '/admin/index.html';
          return;
      }

      await fetchRooms();
      renderRoomsForCurrentPage();
      renderPagination();

      const dealsContainer = document.getElementById('dealsGrid');
      if(dealsContainer){
          dealsContainer.innerHTML = '';
          allRooms.slice(0, 4).forEach(room => {
              const card = document.createElement('div');
              card.className = 'resort-card';
              const formattedPrice = new Intl.NumberFormat('vi-VN', {
                  style: 'currency', currency: 'VND'
              }).format(room.price_per_night);
              card.innerHTML = `
                  <img src="${room.images?.[0] || 'Assets/placeholder.jpg'}" alt="${room.resort_name || room.room_type}">
                  <div class="resort-info">
                      <h3>${room.resort_name || room.room_type}</h3>
                      <p><i class="fas fa-map-marker-alt"></i> ${getLocationName(room.location)}</p>
                      <p class="price">T·ª´ <span>${formattedPrice}/ƒë√™m</span></p>
                  </div>`;
              dealsContainer.appendChild(card);
          });
      }

      document.querySelectorAll('.type-btn').forEach(btn => {
          btn.addEventListener('click', () => {
              document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
              btn.classList.add('active');
          });
      });
      document.getElementById('nextBtn').onclick = () => document.getElementById('promoGrid').scrollBy({ left: 360, behavior: 'smooth' });
      document.getElementById('prevBtn').onclick = () => document.getElementById('promoGrid').scrollBy({ left: -360, behavior: 'smooth' });

      if (typeof destinations !== 'undefined') {
          destinations.forEach(place => {
              const card = document.createElement('div');
              card.className = 'destination-card';
              card.innerHTML = `
                <img src="${place.image}" alt="${place.name}">
                <p>${place.name}</p>
              `;
              document.getElementById('destinationGrid').appendChild(card);
          });
      }
  });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const navbarMenu = document.querySelector(".navbar-menu");
      const username = localStorage.getItem("username");
      const full_name = localStorage.getItem("full_name");

      if (username || full_name) {
        navbarMenu.innerHTML = `
          <a href="">Khuy·∫øn m√£i</a>
          <a href="supports/support.html">H·ªó tr·ª£</a>
          <a href="">H·ª£p t√°c v·ªõi ch√∫ng t√¥i</a>
          <a href="">ƒê·∫∑t ch·ªó c·ªßa t√¥i</a>
          <div class="user-menu">
            <span class="user-name">üë§ ${full_name || username}</span>
            <button id="logoutBtn" class="btn-logout">ƒêƒÉng xu·∫•t</button>
          </div>
        `;
        document.getElementById("logoutBtn").addEventListener("click", () => {
          localStorage.clear();
          window.location.href = "login.html";
        });
      }
    });
  </script>
</body>
</html>