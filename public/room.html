<!DOCTYPE html>
<html lang="vi">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 <title>Chi ti·∫øt Resort</title>
 <link rel="stylesheet" href="room.css" />
 <script src="https://kit.fontawesome.com/a2e0e6ad73.js" crossorigin="anonymous"></script>
<style>
  /* Reset for better consistency */
  body { font-family: sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }
  main { max-width: 900px; margin: 20px auto; padding: 0 15px; }

  /* Header & Footer */
  header { 
        text-align: center; 
        padding: 20px 0; 
        background: #007bff; 
        color: white; 
        margin: 0;
        position: relative; 
    }
  footer p { text-align: center; padding: 10px 0; background: #333; color: white; margin-top: 20px; }

    /* ‚≠ê UPDATED: Return Button Styling (Moved to Left) */
    .return-btn {
        position: absolute;
        /* ‚≠ê CHANGE 1: Use left: 20px instead of right: 20px */
        left: 20px;
        right: auto; /* Ensure 'right' is not conflicting */
        top: 50%;
        transform: translateY(-50%);
        padding: 8px 15px;
        background-color: #f8f9fa;
        color: #007bff;
        border: 2px solid #007bff;
        border-radius: 6px;
        text-decoration: none;
        font-weight: bold;
        transition: all 0.2s ease-in-out;
        z-index: 10;
    }

    .return-btn:hover {
        background-color: #007bff;
        color: white;
        border-color: white;
    }
    /* End of UPDATED: Return Button Styling */

  /* Room Detail Section */
  .room-detail { display: flex; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 40px; }
  .room-image-container { flex: 1; margin-right: 20px; }
  .room-image-container img { width: 100%; height: auto; border-radius: 10px; }
  .room-info { flex: 2; }
  .price { font-size: 1.5em; color: #d9534f; font-weight: bold; margin-bottom: 15px; }
  .location { color: #555; margin-bottom: 10px; }

  /* Review Form & List Styles */
  .reviews-section {
   margin: 40px auto;
   padding: 20px;
   max-width: 100%;
   background: #fafafa;
   border-radius: 12px;
   box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  /* STAR STYLING: Input (Font Awesome) and Display (Unicode) */
  .stars i {
   color: #ccc;
   cursor: pointer;
   font-size: 1.5em;
   margin: 0 2px;
   transition: color 0.2s;
  }
  .stars i.selected {
   color: gold;
  }

  /* Unicode Stars in Displayed Reviews */
  .review-header .stars {
   color: gold;
   font-size: 1.2em;
   letter-spacing: 1px;
  }
  
  .review-header .stars::before {
    content: attr(data-unfilled);
    color: #ccc;
  }
  
  .review-form textarea {
   width: 100%;
   margin-top: 10px;
   padding: 10px;
   border-radius: 8px;
   border: 1px solid #ccc;
   resize: vertical;
  }

  .submit-btn, .book-btn {
   margin-top: 10px;
   padding: 10px 20px;
   background: #007bff;
   color: white;
   border: none;
   border-radius: 8px;
   cursor: pointer;
   transition: background 0.3s;
  }
  .submit-btn:hover, .book-btn:hover { background: #0056b3; }

  .review-item {
   background: #fff;
   border-radius: 8px;
   padding: 15px;
   margin-bottom: 15px;
   box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  .review-header {
   display: flex;
   justify-content: space-between;
   align-items: center;
   margin-bottom: 5px;
  }
  .review-item small { color: #888; display: block; margin-top: 5px; font-size: 0.85em; }

  @media (max-width: 768px) {
   .room-detail { flex-direction: column; }
   .room-image-container { margin-right: 0; margin-bottom: 20px; }
  }
</style>
</head>
<body>
 <header>
 <h1 class="site-title">üå¥ Resort Booking</h1>
  <a href="home.html" class="return-btn">
    <i class="fas fa-home"></i> V·ªÅ trang ch·ªß
  </a>
</header>

 <main>
  <section id="room-detail" class="room-detail">
   <div class="room-image-container">
    <img id="room-image" src="assets/default.jpg" alt="Resort image">
   </div>

   <div class="room-info">
    <h2 id="room-name">ƒêang t·∫£i...</h2>
    <p id="room-location" class="location"><i class="fas fa-map-marker-alt"></i></p>
    <p id="room-type"></p>
    <p id="room-capacity"></p>
    <p id="room-price" class="price"></p>
    <p id="room-description" class="description"></p>
    <div class="amenities" id="room-amenities"></div>

    <button id="book-btn" class="book-btn">ƒê·∫∑t ph√≤ng ngay</button>
   </div>
  </section>

    <section id="reviews" class="reviews-section">
   <h3>ƒê√°nh gi√° & B√¨nh lu·∫≠n</h3>
   <div id="review-list"></div>

   <form id="review-form" class="review-form">
    <label for="rating">ƒê√°nh gi√° c·ªßa b·∫°n:</label>
    <div id="star-rating" class="stars">
          <i class="fas fa-star" data-value="1"></i>
     <i class="fas fa-star" data-value="2"></i>
     <i class="fas fa-star" data-value="3"></i>
     <i class="fas fa-star" data-value="4"></i>
     <i class="fas fa-star" data-value="5"></i>
    </div>

    <textarea id="comment" rows="3" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..."></textarea>
    <button type="submit" class="submit-btn">G·ª≠i ƒë√°nh gi√°</button>
   </form>
  </section>
 </main>

 <footer>
  <p>¬© 2025 Resort Booking</p>
 </footer>

 <script>
  const API_BASE = window.location.origin + '/api';
  let selectedRating = 0;

  function formatCurrency(amount) {
   return new Intl.NumberFormat('vi-VN', {
    style: 'currency',
    currency: 'VND'
   }).format(amount);
  }

  function getRoomIdFromUrl() {
   const params = new URLSearchParams(window.location.search);
   return params.get('id');
  }

  async function loadReviews(roomId) {
   const container = document.getElementById('review-list');
   container.innerHTML = "<p>ƒêang t·∫£i ƒë√°nh gi√°...</p>";

   try {
    const res = await fetch(`${API_BASE}/reviews/${roomId}`);
    if (!res.ok) throw new Error('L·ªói khi t·∫£i ƒë√°nh gi√°');
    const reviews = await res.json();

    container.innerHTML = reviews.length
     ? reviews.map(r => `
      <div class="review-item">
       <div class="review-header">
        <strong>${r.username || 'Ng∆∞·ªùi d√πng'}</strong>
        <span class="stars">${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5 - r.rating)}</span>
       </div>
       <p>${r.comment}</p>
       <small>${new Date(r.created_at).toLocaleString('vi-VN')}</small>
      </div>
     `).join('')
     : "<p>Ch∆∞a c√≥ ƒë√°nh gi√° n√†o.</p>";
   } catch (err) {
    console.error('L·ªói t·∫£i ƒë√°nh gi√°:', err);
    container.innerHTML = "<p>L·ªói khi t·∫£i ƒë√°nh gi√°.</p>";
   }
  }

  async function loadRoomDetail() {
   const id = getRoomIdFromUrl();
   if (!id) {
    document.getElementById('room-detail').innerHTML = "<p>Kh√¥ng t√¨m th·∫•y resort.</p>";
    return;
   }

   try {
    const res = await fetch(`${API_BASE}/rooms/${id}`);
    if (!res.ok) throw new Error('API error');
    const room = await res.json();

    document.getElementById('room-image').src =
     (typeof room.images === 'string' ? room.images.split(',')[0] : room.images?.[0]) || 'assets/default.jpg';

    document.getElementById('room-name').textContent = room.resort_name || "Kh√¥ng c√≥ t√™n";
    document.getElementById('room-location').innerHTML =
     `<i class="fas fa-map-marker-alt"></i> ${room.location || ''}`;
    document.getElementById('room-type').textContent = `Lo·∫°i ph√≤ng: ${room.room_type || ''}`;
    document.getElementById('room-capacity').textContent = `S·ª©c ch·ª©a: ${room.capacity || 1} kh√°ch`;
    document.getElementById('room-price').textContent =
     `${formatCurrency(room.price_per_night || 0)} / ƒë√™m`;
    document.getElementById('room-description').textContent = room.description || "Ch∆∞a c√≥ m√¥ t·∫£.";

    const amenitiesContainer = document.getElementById('room-amenities');
    amenitiesContainer.innerHTML = '';
    if (room.amenities && room.amenities.length) {
     amenitiesContainer.innerHTML = `
      <h3>Ti·ªán nghi</h3>
      <ul>${room.amenities.map(a => `<li>${a}</li>`).join('')}</ul>
     `;
    }

    await loadReviews(id);
   } catch (err) {
    console.error('L·ªói t·∫£i resort:', err);
    document.getElementById('room-detail').innerHTML = "<p>L·ªói t·∫£i th√¥ng tin resort.</p>";
   }
  }

  document.addEventListener('DOMContentLoaded', () => {
   loadRoomDetail();

   // Star rating handler for the form (Font Awesome icons)
   const stars = document.querySelectorAll('#star-rating .fa-star');
   stars.forEach(star => {
    star.addEventListener('click', () => {
     selectedRating = parseInt(star.dataset.value);
     stars.forEach((s, i) => {
      s.classList.toggle('selected', parseInt(s.dataset.value) <= selectedRating);
     });
    });
   });

   // Submit review handler
   document.getElementById('review-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const comment = document.getElementById('comment').value.trim();
    const roomId = getRoomIdFromUrl();

    if (!selectedRating) {
     alert('Vui l√≤ng ch·ªçn s·ªë sao.');
     return;
    }
    if (!comment) {
     alert('Vui l√≤ng nh·∫≠p b√¨nh lu·∫≠n.');
     return;
    }

    try {
     // Show a temporary loading state
     const submitButton = document.querySelector('.submit-btn');
     submitButton.textContent = 'ƒêang g·ª≠i...';
     submitButton.disabled = true;

     const res = await fetch(`${API_BASE}/reviews/${roomId}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ rating: selectedRating, comment })
     });

     submitButton.textContent = 'G·ª≠i ƒë√°nh gi√°';
     submitButton.disabled = false;

     if (!res.ok) throw new Error('L·ªói khi g·ª≠i ƒë√°nh gi√°');

     alert('C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√°!');
     document.getElementById('comment').value = '';
     selectedRating = 0;
     // Reset star appearance
     document.querySelectorAll('#star-rating .fa-star').forEach(s => s.classList.remove('selected'));
     await loadReviews(roomId);
    } catch (err) {
     console.error('L·ªói g·ª≠i ƒë√°nh gi√°:', err);
     alert('Kh√¥ng th·ªÉ g·ª≠i ƒë√°nh gi√°. Vui l√≤ng th·ª≠ l·∫°i.');
    }
   });
  });
 </script>
</body>
</html>