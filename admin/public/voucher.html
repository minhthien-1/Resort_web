<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Voucher</title>
    <link rel="stylesheet" href="assets/css/layout.css">
</head>

<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="sidebar-logo">
                üè® Resort
            </div>
            <ul class="sidebar-menu" id="sidebarMenu">
                <li data-page="index.html">üìä B·∫£ng ƒëi·ªÅu khi·ªÉn</li>
                <li data-page="rooms.html">üè† ƒê·∫∑t ph√≤ng</li>
                <li data-page="maintenance.html">üîß Ch√≠nh s·ª≠a ph√≤ng</li>
                <li data-page="voucher.html" class="active">üéüÔ∏è Voucher</li>
                <li data-page="customers.html">üë• Kh√°ch h√†ng</li>
                <li data-page="reports.html">üìã B√°o c√°o</li>
                <li onclick="logout()">üì§ ƒêƒÉng xu·∫•t</li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-title">Qu·∫£n L√Ω Voucher</div>
                <div class="header-actions">
                    <button class="btn btn-secondary">üîç T√¨m ki·∫øm</button>
                    <button class="btn btn-primary" onclick="openAddModal()">+ Th√™m Voucher</button>
                </div>
            </div>

            <!-- Content -->
            <div class="content">
                <div class="search-bar">
                    <input type="text" placeholder="T√¨m ki·∫øm voucher..." id="searchInput">
                    <select style="padding: 10px 15px; border: 1px solid #d0d7e0; border-radius: 6px; font-size: 14px;">
                        <option>T·∫•t c·∫£</option>
                        <option>ƒêang ho·∫°t ƒë·ªông</option>
                        <option>Kh√¥ng ho·∫°t ƒë·ªông</option>
                    </select>
                </div>

                <div class="table-wrapper">
                    <table id="voucherTable">
                        <thead>
                            <tr>
                                <th>M√£ Voucher</th>
                                <th>T√™n Voucher</th>
                                <th>Gi·∫£m Gi√°</th>
                                <th>L∆∞·ª£t D√πng</th>
                                <th>Ng√†y H·∫øt H·∫°n</th>
                                <th>Tr·∫°ng Th√°i</th>
                                <th>H√†nh ƒê·ªông</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>

                <div class="pagination" id="pagination">
                    <!-- Pagination buttons s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Th√™m/S·ª≠a Voucher -->
    <div class="modal" id="voucherModal">
        <div class="modal-content">
            <div class="modal-header" id="modalTitle">Th√™m Voucher M·ªõi</div>

            <form>
                <div class="form-group">
                    <label>M√£ Voucher *</label>
                    <input type="text" id="voucherCode" placeholder="VD: SUMMER2024" required>
                </div>

                <div class="form-group">
                    <label>T√™n Voucher *</label>
                    <input type="text" id="voucherName" placeholder="T√™n khuy·∫øn m√£i" required>
                </div>

                <div class="form-group">
                    <label>Gi·∫£m Gi√° (%) *</label>
                    <input type="number" id="discountPercent" placeholder="20" min="0" max="100" required>
                </div>

                <div class="form-group">
                    <label>L∆∞·ª£t D√πng T·ªëi ƒêa *</label>
                    <input type="number" id="maxUses" placeholder="100" min="1" required>
                </div>

                <div class="form-group">
                    <label>Ng√†y H·∫øt H·∫°n *</label>
                    <input type="date" id="expiryDate" required>
                </div>

                <div class="form-group">
                    <label>M√¥ T·∫£</label>
                    <textarea id="description" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ voucher..."></textarea>
                </div>

                <div class="form-group">
                    <label>Tr·∫°ng Th√°i</label>
                    <select id="status">
                        <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                        <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                    </select>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u Voucher</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let vouchers = [
            { id: 1, code: 'SUMMER2024', name: 'Khuy·∫øn M√£i H√®', discount: 20, maxUses: 100, usedCount: 45, expiryDate: '31/12/2024', status: 'active', description: 'Khuy·∫øn m√£i h√® 2024' },
            { id: 2, code: 'WELCOME', name: 'Ch√†o M·ª´ng Kh√°ch M·ªõi', discount: 15, maxUses: 500, usedCount: 320, expiryDate: '28/02/2025', status: 'active', description: 'Voucher ch√†o m·ª´ng' },
            { id: 3, code: 'SPRING25', name: 'Khuy·∫øn M√£i Xu√¢n', discount: 30, maxUses: 200, usedCount: 0, expiryDate: '15/03/2025', status: 'inactive', description: 'Khuy·∫øn m√£i m√πa xu√¢n' },
            { id: 4, code: 'FALL2024', name: 'Khuy·∫øn M√£i Thu', discount: 25, maxUses: 150, usedCount: 80, expiryDate: '30/09/2024', status: 'active', description: 'Khuy·∫øn m√£i m√πa thu' },
            { id: 5, code: 'WINTER25', name: 'Khuy·∫øn M√£i ƒê√¥ng', discount: 35, maxUses: 200, usedCount: 120, expiryDate: '31/01/2025', status: 'active', description: 'Khuy·∫øn m√£i m√πa ƒë√¥ng' },
            { id: 6, code: 'NEWYEAR', name: 'NƒÉm M·ªõi', discount: 40, maxUses: 300, usedCount: 0, expiryDate: '15/01/2025', status: 'inactive', description: 'Khuy·∫øn m√£i nƒÉm m·ªõi' }
        ];

        let currentEditId = null;
        let currentPage = 1;
        const itemsPerPage = 3;

        function openAddModal() {
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Th√™m Voucher M·ªõi';
            document.getElementById('voucherModal').classList.add('active');
            resetForm();
        }

        function openEditModal(id) {
            currentEditId = id;
            const voucher = vouchers.find(v => v.id === id);
            if (voucher) {
                document.getElementById('modalTitle').textContent = 'Ch·ªânh S·ª≠a Voucher';
                document.getElementById('voucherCode').value = voucher.code;
                document.getElementById('voucherName').value = voucher.name;
                document.getElementById('discountPercent').value = voucher.discount;
                document.getElementById('maxUses').value = voucher.maxUses;
                document.getElementById('expiryDate').value = convertDateFormat(voucher.expiryDate);
                document.getElementById('description').value = voucher.description;
                document.getElementById('status').value = voucher.status;
                document.getElementById('voucherModal').classList.add('active');
            }
        }

        function closeModal() {
            document.getElementById('voucherModal').classList.remove('active');
            resetForm();
            currentEditId = null;
        }

        function resetForm() {
            document.querySelector('form').reset();
        }

        function convertDateFormat(dateStr) {
            const [day, month, year] = dateStr.split('/');
            return `${year}-${month}-${day}`;
        }

        function convertDateFormatBack(dateStr) {
            const [year, month, day] = dateStr.split('-');
            return `${day}/${month}/${year}`;
        }

        function saveVoucher(e) {
            e.preventDefault();

            const code = document.getElementById('voucherCode').value;
            const name = document.getElementById('voucherName').value;
            const discount = parseInt(document.getElementById('discountPercent').value);
            const maxUses = parseInt(document.getElementById('maxUses').value);
            const expiryDate = convertDateFormatBack(document.getElementById('expiryDate').value);
            const description = document.getElementById('description').value;
            const status = document.getElementById('status').value;

            if (currentEditId) {
                const index = vouchers.findIndex(v => v.id === currentEditId);
                if (index !== -1) {
                    vouchers[index] = {
                        ...vouchers[index],
                        code,
                        name,
                        discount,
                        maxUses,
                        expiryDate,
                        description,
                        status
                    };
                    alert('Voucher ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng!');
                }
            } else {
                const newVoucher = {
                    id: Math.max(...vouchers.map(v => v.id), 0) + 1,
                    code,
                    name,
                    discount,
                    maxUses,
                    usedCount: 0,
                    expiryDate,
                    description,
                    status
                };
                vouchers.push(newVoucher);
                alert('Voucher ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng!');
            }

            closeModal();
            renderTable();
        }

        function deleteVoucher(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a voucher n√†y?')) {
                vouchers = vouchers.filter(v => v.id !== id);
                alert('Voucher ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng!');
                renderTable();
            }
        }

        function renderTable() {
            const tbody = document.querySelector('#voucherTable tbody');
            tbody.innerHTML = '';

            // T√≠nh to√°n ph·∫ßn trang hi·ªÉn th·ªã
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedVouchers = vouchers.slice(startIndex, endIndex);

            paginatedVouchers.forEach(voucher => {
                const row = document.createElement('tr');
                const statusBadge = voucher.status === 'active'
                    ? '<span class="status-badge status-active">ƒêang ho·∫°t ƒë·ªông</span>'
                    : '<span class="status-badge status-inactive">Kh√¥ng ho·∫°t ƒë·ªông</span>';

                row.innerHTML = `
                    <td><strong>${voucher.code}</strong></td>
                    <td>${voucher.name}</td>
                    <td>${voucher.discount}%</td>
                    <td>${voucher.usedCount}/${voucher.maxUses}</td>
                    <td>${voucher.expiryDate}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-edit btn-sm" onclick="openEditModal(${voucher.id})">‚úèÔ∏è</button>
                            <button class="btn btn-delete btn-sm" onclick="deleteVoucher(${voucher.id})">üóëÔ∏è</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });

            renderPagination();
        }

        function renderPagination() {
            const paginationDiv = document.getElementById('pagination');
            paginationDiv.innerHTML = '';

            const totalPages = Math.ceil(vouchers.length / itemsPerPage);

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = i === currentPage ? 'active' : '';
                btn.addEventListener('click', () => {
                    currentPage = i;
                    renderTable();
                });
                paginationDiv.appendChild(btn);
            }
        }

        // Navigation
        document.querySelectorAll('.sidebar-menu li[data-page]').forEach(item => {
            item.addEventListener('click', function () {
                const page = this.getAttribute('data-page');
                window.location.href = page;
            });
        });

        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?')) {
                window.location.href = 'login.html';
            }
        }

        // Events
        document.querySelector('form').addEventListener('submit', saveVoucher);
        document.getElementById('voucherModal').addEventListener('click', function (e) {
            if (e.target === this) closeModal();
        });
        document.getElementById('searchInput').addEventListener('keyup', function (e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#voucherTable tbody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Load table on page load
        renderTable();
    </script>
</body>

</html>